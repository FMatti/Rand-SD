%%% LANGUAGE AND FONTS

% Typesetting packages
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[activate={true,nocompatibility},
            final,
            tracking=true,
            kerning=true,
            spacing=false,
            factor=1100,
            stretch=10,
            shrink=10]{microtype}

% English language package
\usepackage[english]{babel}

% Package for stylizing quotes
\usepackage{csquotes}

% Set font to Palatino with Euler math
\usepackage{palatino}
\usepackage{eulervm}
\renewcommand\familydefault{\rmdefault}

% Comment
\newcommand\todo[1]{{{\color{red}#1}}}


%%% COLOR THEME

% Color package
\usepackage{xcolor}

% Color definitions
\definecolor{darkblue}{HTML}{2F455C}
\definecolor{mainblue}{HTML}{0e437c}
\colorlet{lightblue}{darkblue!10!white}
\colorlet{linkcolor}{mainblue}


%%% PAGE THEME

% Page layout
\usepackage[textwidth=420pt,
            textheight=640pt,
            headheight=15pt,
            voffset=40pt]{geometry}

% Section title styles
\renewcommand\section{\@startsection{section}{1}{\z@}
                                   {-3.5ex \@plus -1.3ex \@minus -.7ex}
                                   {2.3ex \@plus.4ex \@minus .4ex}
                                   {\scshape\Large\bfseries}}
\renewcommand\subsection{\@startsection{subsection}{2}{\z@}
                                   {-2.3ex\@plus -1ex \@minus -.5ex}
                                   {1.2ex \@plus .3ex \@minus .3ex}
                                   {\scshape\large\bfseries}}
\renewcommand\subsubsection{\@startsection{subsubsection}{3}{\z@}
                                   {-2.3ex\@plus -1ex \@minus -.5ex}
                                   {1ex \@plus .2ex \@minus .2ex}
                                   {\scshape\normalsize\bfseries}}

% Command for adding empty page
\newcommand\emptypage{
  \newpage
  \thispagestyle{empty}
  \mbox{}
  \newpage
}


%%% REFERENCING

% Bibliography management
\usepackage[square, numbers]{natbib}
\bibliographystyle{plainnat}
\newcommand*{\doi}[1]{\href{https://doi.org/#1}{doi: #1}}

% Links
\usepackage{url}
\urlstyle{same}

% Clickable references
\usepackage[linktoc=all]{hyperref}
\hypersetup{citecolor=linkcolor}
\bibpunct{\color{linkcolor}[}{\color{linkcolor}]}{,}{n}{}{;}

% Enumerations within section (Figure 3.4 instead of maybe Figure 42)
\counterwithin{figure}{chapter}
\counterwithin{table}{chapter}
\counterwithin{equation}{chapter}
\usepackage[list=true, listformat=simple]{subcaption}

% Reference commands
\newcommand{\reffig}[1]{\hyperref[#1]{\textcolor{linkcolor}{figure \ref*{#1}}}}
\newcommand{\Reffig}[1]{\hyperref[#1]{\textcolor{linkcolor}{Figure \ref*{#1}}}}
\newcommand{\reftab}[1]{\hyperref[#1]{\textcolor{linkcolor}{table \ref*{#1}}}}
\newcommand{\Reftab}[1]{\hyperref[#1]{\textcolor{linkcolor}{Table \ref*{#1}}}}
\newcommand{\refdef}[1]{\hyperref[#1]{\textcolor{linkcolor}{definition \ref*{#1}}}}
\newcommand{\Refdef}[1]{\hyperref[#1]{\textcolor{linkcolor}{Definition \ref*{#1}}}}
\newcommand{\reflem}[1]{\hyperref[#1]{\textcolor{linkcolor}{lemma \ref*{#1}}}}
\newcommand{\Reflem}[1]{\hyperref[#1]{\textcolor{linkcolor}{Lemma \ref*{#1}}}}
\newcommand{\refthm}[1]{\hyperref[#1]{\textcolor{linkcolor}{theorem \ref*{#1}}}}
\newcommand{\Refthm}[1]{\hyperref[#1]{\textcolor{linkcolor}{Theorem \ref*{#1}}}}
\newcommand{\refalg}[1]{\hyperref[#1]{\textcolor{linkcolor}{algorithm \ref*{#1}}}}
\newcommand{\Refalg}[1]{\hyperref[#1]{\textcolor{linkcolor}{Algorithm \ref*{#1}}}}
\newcommand{\refsec}[1]{\hyperref[#1]{\textcolor{linkcolor}{section \ref*{#1}}}}
\newcommand{\Refsec}[1]{\hyperref[#1]{\textcolor{linkcolor}{Section \ref*{#1}}}}
\newcommand{\refchp}[1]{\hyperref[#1]{\textcolor{linkcolor}{chapter \ref*{#1}}}}
\newcommand{\Refchp}[1]{\hyperref[#1]{\textcolor{linkcolor}{Chapter \ref*{#1}}}}
\newcommand{\reflin}[1]{\hyperref[#1]{\textcolor{linkcolor}{line \ref*{#1}}}}
\newcommand{\Reflin}[1]{\hyperref[#1]{\textcolor{linkcolor}{Line \ref*{#1}}}}
\newcommand{\refequ}[1]{\hyperref[#1]{\textcolor{linkcolor}{(\ref*{#1})}}}


%%% FLOATS

% Figures
\usepackage{graphicx}
\usepackage{tikz}
\usetikzlibrary{fadings}
\usetikzlibrary{calc}

% Table layouting
\usepackage{booktabs}
\usepackage{multirow}

% Caption
\usepackage[font=small,
            labelfont=sc,
            labelsep=endash,
            margin=\parindent,
            tableposition=top]{caption}

% Algorithms
\usepackage[noend]{algpseudocode}


%%% MATHEMATICS

% Mathematics packages
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mathtools}
\usepackage{relsize}

% Fix undefined contorl sequence issue with pyplot pgf exports
\def\mathdefault#1{#1}

% Custom commands
\newcommand{\pp}{\text{\raisebox{0.3ex}{\relscale{0.9}++}}}
\newcommand*\rfrac[2]{{}^{#1}\!/_{#2}}
\newcommand{\mtx}[1]{\boldsymbol{#1}}
\newcommand{\vct}[1]{\boldsymbol{#1}}

% Custom opertators
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\Real}{Re}
\DeclareMathOperator{\Imag}{Im}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\dimension}{dim}
\DeclareMathOperator{\DCT}{DCT}
\DeclareMathOperator{\Hutch}{H}
\DeclareMathOperator{\MSE}{MSE}
\DeclareMathOperator{\range}{range}

% Colorboxes
\usepackage[many]{tcolorbox}
\newtcolorbox{block}[2][]
{
  colframe = darkblue,
  colback  = lightblue,
  coltitle = white,
  title    = {#2},
  sharp corners,
  before skip=10pt,
  after skip=10pt,
  left=3pt,
  right=3pt,
  boxrule=0pt,
  #1,
}

\tcbuselibrary{theorems}

\newtcbtheorem[]{lemma}{Lemma}%
{
  colframe = darkblue,
  colback  = lightblue,
  coltitle = white,
  sharp corners,
  before skip=10pt,
  after skip=10pt,
  left=3pt,
  right=3pt,
  boxrule=0pt,
}{lem}

\newtcbtheorem[]{definition}{Definition}%
{
  colframe = darkblue,
  colback  = lightblue,
  coltitle = white,
  sharp corners,
  before skip=10pt,
  after skip=10pt,
  left=3pt,
  right=3pt,
  boxrule=0pt,
}{def}

\newtcbtheorem[]{theorem}{Theorem}%
{
  colframe = darkblue,
  colback  = lightblue,
  coltitle = white,
  sharp corners,
  before skip=10pt,
  after skip=10pt,
  left=3pt,
  right=3pt,
  boxrule=0pt,
}{thm}

\newtcbtheorem[]{algo}{Algorithm}%
{
  colframe = darkblue,
  colback  = lightblue,
  coltitle = white,
  sharp corners,
  before skip=10pt,
  after skip=10pt,
  left=3pt,
  right=3pt,
  boxrule=0pt,
}{alg}


%%% GLOSSARY

\usepackage{glossaries}

\makeglossaries

\input{glossary.tex}


%%% TITLEPAGE LAYOUT

% Declare report information commands
\newcommand*{\project}[1]{\gdef\@project{#1}}
\newcommand*{\institution}[1]{\gdef\@institution{#1}}
\newcommand*{\supervisor}[1]{\gdef\@supervisor{#1}}
\newcommand*{\lab}[1]{\gdef\@lab{#1}}

% Redefinition of the \maketitle command
\renewcommand*{\maketitle}{
    \begin{titlepage}
    \centering
    \vspace{2cm}
    {\scshape\Large\@project\unskip\strut\par}
    \vspace{2cm}
    {\Huge\bfseries\@title\unskip\strut\par}
    \vspace{3cm}
    { % EPFL Logo
    \begin{center}
      \begin{tikzpicture}
        % "E"
        \begin{scope}[shift={(0, 0)}]
            \fill[red] (0, 0) to (0.9, 0) to (0.9, 0.23) to (0.27, 0.23) to (0.27, 0.51) to (0.0, 0.51);
            \begin{scope}[shift={(0, 1.25)}, yscale=-1]
                \fill[red] (0, 0) to (0.9, 0) to (0.9, 0.23) to (0.27, 0.23) to (0.27, 0.51) to (0.0, 0.51);
            \end{scope}
            \fill[red] (0.27, 0.51) rectangle (0.85, 0.74);
        \end{scope}

        % "P"
        \begin{scope}[shift={(1.125, 0)}]
            \fill[red] (0.01, 0) to (0.27, 0.0) to (0.27, 0.51) to (0.62, 0.51) arc (-90:90:0.37) to (0.01, 1.25);
            \fill[white] (0.27, 0.74) to (0.62, 0.74) arc (-90:90:0.15) to (0.27, 1.04);
        \end{scope}

        % "F"
        \begin{scope}[shift={(2.29, 0)}]
            \fill[red] (0, 0) rectangle (0.27, 0.51);
            \begin{scope}[shift={(0, 1.25)}, yscale=-1]
                \fill[red] (0, 0) to (0.9, 0) to (0.9, 0.23) to (0.27, 0.23) to (0.27, 0.51) to (0.0, 0.51);
            \end{scope}
            \fill[red] (0.27, 0.51) rectangle (0.85, 0.74);
        \end{scope}

        % "L"
        \begin{scope}[shift={(3.39, 0)}]
            \fill[red] (0, 0) to (0.9, 0) to (0.9, 0.23) to (0.27, 0.23) to (0.27, 1.25) to (0.0, 1.25);
        \end{scope}

    \end{tikzpicture}
  \end{center}
    }
    \vspace{3cm}
    {\Large\itshape\@author\unskip\strut\par}
    \vfill
    supervised by\par
    \vspace{0.5cm}
    {\large\@supervisor\unskip\strut\par}
    \vspace{0.5cm}
    from the\par
    \vspace{0.5cm}
    {\large\@lab\unskip\strut\par}
    \vfill
    {\large \@date\par}
    \end{titlepage}
}
