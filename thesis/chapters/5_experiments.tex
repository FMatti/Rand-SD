\chapter{Numerical experiments}
\label{chp:5-experiments}

\todo{[Overview table of methods]}

\section{Model problem from density functional theory}
\label{sec:5-experiments-density-function}

\todo{Convert to written form}

Matrix which results from second order finite difference discretization of
\begin{equation}
    \mathcal{A} u(\vct{x}) = - \Delta u(\vct{x}) + V_n(\vct{x}) u(\vct{x})
    \label{equ:5-experiments-electronic-hamiltonian}
\end{equation}

with mesh size $h=0.6$ \cite{lin2017randomized}.

Potential is periodic repetition of length $L=6$ unit cell in whose
center there is a Gaussian
\begin{equation}
    V_1(\vct{x}) = \alpha \exp(-\frac{\lVert \vct{x} \rVert _2^2}{ 2 \beta^2 })
\end{equation}

with $\alpha = 4$, $\beta = 2$ located in the center of the unit cell. For $n=2, 3, \dots$,
we consider $n$ cells together in each dimension in our computation.

\begin{figure}[ht]
    \begin{subfigure}[b]{0.33\columnwidth}
        \input{plots/periodic_gaussian_well_1.pgf}
        \caption{$n=1$}
        \label{fig:5-experiments-periodic-gaussian-well-1}
    \end{subfigure}
    \begin{subfigure}[b]{0.33\columnwidth}
        \input{plots/periodic_gaussian_well_2.pgf}
        \caption{$n=2$}
        \label{fig:5-experiments-periodic-gaussian-well-2}
    \end{subfigure}
    \begin{subfigure}[b]{0.33\columnwidth}
        \input{plots/periodic_gaussian_well_5.pgf}
        \caption{$n=5$}
        \label{fig:5-experiments-periodic-gaussian-well-5}
    \end{subfigure}
    \caption{Two dimensional periodic Gaussian wells for different $n$.}
    \label{fig:5-experiments-periodic-gaussian-well}
\end{figure}

How error is computed

Exact computation of eigenvalues for baseline.

\clearpage
\begin{figure}[ht]
    \begin{subfigure}[b]{0.45\columnwidth}
        \input{plots/electronic_structure_convergence_nv_m800.pgf}
        \caption{$m=800$}
        \label{fig:5-experiments-electronic-structure-convergence-nv-m800}
    \end{subfigure}
    \begin{subfigure}[b]{0.5\columnwidth}
        \input{plots/electronic_structure_convergence_nv_m2400.pgf}
        \caption{$m=2400$}
        \label{fig:5-experiments-electronic-structure-convergence-nv-m2400}
    \end{subfigure}
    \caption{Behavior with $n_v$ for $\sigma=0.05$}
    \label{fig:5-experiments-electronic-structure-convergence-nv}
\end{figure}

\begin{figure}[ht]
    \centering
    \begin{subfigure}[b]{0.45\columnwidth}
        \input{plots/electronic_structure_convergence_m_nv40.pgf}
        \caption{$n_v=40$}
        \label{fig:5-experiments-electronic-structure-convergence-m-nv40}
    \end{subfigure}
    \begin{subfigure}[b]{0.5\columnwidth}
        \input{plots/electronic_structure_convergence_m_nv160.pgf}
        \caption{$n_v=160$}
        \label{fig:5-experiments-electronic-structure-convergence-m-nv160}
    \end{subfigure}
    \caption{Behavior with $m$ for $\sigma=0.05$}
    \label{fig:5-experiments-electronic-structure-convergence-m}
\end{figure}

\begin{figure}[ht]
    \centering
    \input{plots/electronic_structure_matvec_mixture.pgf}
    \caption{Allocation of mat-vecs to low-rank and trace approximation.}
    \label{fig:5-experiments-electronic-structure-matvec-mixture}
\end{figure}

\begin{table}[h]
    \caption{Runtime comparison}
    \label{tab:5-experiments-electronic-structure-runtime}
    \centering
    \renewcommand{\arraystretch}{1.2}
    \begin{tabular}{@{}lcccc@{}}
        \toprule
        Parmameters & $m=800,n_v=40$ & $m=2400,n_v=40$ & $m=800,n_v=160$ & $m=2400,n_v=160$ \\
        \midrule
        \gls{DGC} & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 \\
        \gls{NC} & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 \\
        \gls{NCPP} & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 \\
        \bottomrule
    \end{tabular}
\end{table}

\section{Benchmark against Haydock's method}
\label{sec:5-experiments-haydock-method}

Different kernel
\begin{equation}
    g_{\sigma}(t) = \frac{1}{\pi} \frac{\sigma}{t^2 + \sigma^2} = -\frac{1}{\pi} \Imag\left\{ \frac{1}{t + i\sigma} \right\}
    \label{equ:5-experiments-cauchy-kernel}
\end{equation}

Conversion to trace estimation problem
\begin{equation}
    \phi_{\sigma}(t) = - \frac{1}{n \pi} \Imag \left\{ \Tr\left[((t + i\sigma)I - A)^{-1}\right]  \right\}.
    \label{equ:5-experiments-haydock-trace}
\end{equation}
Use Hutchinson's to estimate trace
\begin{equation}
    \frac{1}{n_v} \sum_{j=1}^{n_v} \left( \vct{\psi}^{(j)} \right)^{\top} ((t - i\sigma)\mtx{I} - \mtx{A})^{-1} \vct{\psi}^{(j)}
    \label{equ:5-experiments-haydock-hutchinson}
\end{equation}
where each summand can be efficiently evaluated for all $t$ from the Arnoldi decomposition of $\mtx{A}$ with starting vector $\vct{\psi}$
\begin{align}
    \vct{\psi}^{\top} ((t - i\sigma)\mtx{I} - \mtx{A})^{-1} \vct{\psi} &\approx \vct{e}_1^{\top} ((t - i\sigma)\mtx{I} - \mtx{H}_k)^{-1} \vct{e}_1 \notag \\
    &= \cfrac{1}{(t - i\sigma) - \alpha_1 - \cfrac{\beta_2^2}{(t - i\sigma) - \alpha_2 - \dots}}
    \label{equ:5-experiments-haydock-recursion}
\end{align}

\clearpage
\begin{figure}[ht]
    \begin{subfigure}[b]{0.45\columnwidth}
        \input{plots/haydock_convergence_nv_m800.pgf}
        \caption{$m=800$}
        \label{fig:5-experiments-haydock-convergence-nv-m800}
    \end{subfigure}
    \begin{subfigure}[b]{0.5\columnwidth}
        \input{plots/haydock_convergence_nv_m2400.pgf}
        \caption{$m=2400$}
        \label{fig:5-experiments-haydock-convergence-nv-m2400}
    \end{subfigure}
    \caption{Behavior with $n_v$ for $\sigma=0.05$}
    \label{fig:5-experiments-haydock-convergence-nv}
\end{figure}

\begin{figure}[ht]
    \centering
    \begin{subfigure}[b]{0.45\columnwidth}
        \input{plots/haydock_convergence_m_nv40.pgf}
        \caption{$n_v=40$}
        \label{fig:5-experiments-haydock-convergence-m-nv40}
    \end{subfigure}
    \begin{subfigure}[b]{0.5\columnwidth}
        \input{plots/haydock_convergence_m_nv160.pgf}
        \caption{$n_v=160$}
        \label{fig:5-experiments-haydock-convergence-m-nv160}
    \end{subfigure}
    \caption{Behavior with $m$ for $\sigma=0.05$}
    \label{fig:5-experiments-haydock-convergence-m}
\end{figure}

\begin{table}[h]
    \caption{Runtime comparison}
    \label{tab:5-experiments-haydock-runtime}
    \centering
    \renewcommand{\arraystretch}{1.2}
    \begin{tabular}{@{}lcccc@{}}
        \toprule
        Parmameters & $m=800,n_v=40$ & $m=2400,n_v=40$ & $m=800,n_v=160$ & $m=2400,n_v=160$ \\
        \midrule
        Haydock & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 \\
        \gls{NC} & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 \\
        \gls{NCPP} & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 & 0.00 $\pm$ 0.00 \\
        \bottomrule
    \end{tabular}
\end{table}

\section{Application to various matrices}
\label{sec:5-experiments-various-matrices}

\todo{[Same plots for multiple matrices]}
